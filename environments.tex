%tikz for graphs and mdframed
\usepackage{tikz}
\usetikzlibrary{decorations.pathmorphing}
%theorem related packages
\usepackage{thmtools}
\usepackage{import}
\usepackage{xifthen}
\usepackage{pdfpages}
\usepackage{transparent}
\usepackage{ifoddpage}
\usepackage{tcolorbox}
\tcbset{on line, 
        boxsep=3pt, left=0pt,right=0pt,top=0pt,bottom=0pt,
        colframe=slategreen,colback=slategreen,arc=1pt,outer arc=1pt
        }
%env for adding figures.
\newcommand{\incfig}[1]{%
    \def\svgwidth{\columnwidth}
    \scalebox{.5}{\import{../figures/}{#1.pdf_tex}}
}

%for one side margins
\makeatletter
\@mparswitchfalse%
\setmarginnotes{0.5cm}{4.5cm}{0.2cm}
\makeatother
%need framemethod tikz for round corners, https://tex.stackexchange.com/questions/151532/could-not-get-round-corner-working-in-mdframed
\usepackage[framemethod=TikZ]{mdframed}
% https://tex.stackexchange.com/a/292090/76888
% https://github.com/marcodaniel/mdframed/issues/12


%start of chapter box
\mdfdefinestyle{overviewbox}{%
    roundcorner=5pt,
    linewidth=1pt,
    skipabove=7pt,
    skipbelow=7pt,
    innertopmargin=11pt,
    innerbottommargin=9pt,
    linecolor=lightslategreenborder,
    nobreak=true,
    backgroundcolor=lightslategreen,
}
%environment overview for just after chapter stuff. Move this to a new file later.
\newenvironment{overview}%
  {\begin{minipage}{180mm}\begin{mdframed}[style=overviewbox]}%
  {\end{mdframed}\end{minipage}}

%Figure captions
\captionnamefont{\hspace{-0.25em}\RaggedRight\small\bfseries\sffamily}
\captiontitlefont{\small\RaggedRight\color{gray!30!black}}         % caption text
\captiondelim{\hspace{0.25em}.\ }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%        _____                    _____                    _____                   _______                   _____                    _____                    _____                    _____
%       /\    \                  /\    \                  /\    \                 /::\    \                 /\    \                  /\    \                  /\    \                  /\    \
%      /::\    \                /::\____\                /::\    \               /::::\    \               /::\    \                /::\    \                /::\____\                /::\    \
%      \:::\    \              /:::/    /               /::::\    \             /::::::\    \             /::::\    \              /::::\    \              /::::|   |               /::::\    \
%       \:::\    \            /:::/    /               /::::::\    \           /::::::::\    \           /::::::\    \            /::::::\    \            /:::::|   |              /::::::\    \
%        \:::\    \          /:::/    /               /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \          /:::/\:::\    \          /::::::|   |             /:::/\:::\    \
%         \:::\    \        /:::/____/               /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \        /:::/__\:::\    \        /:::/|::|   |            /:::/__\:::\    \
%         /::::\    \      /::::\    \              /::::\   \:::\    \     /:::/    / \:::\    \     /::::\   \:::\    \      /::::\   \:::\    \      /:::/ |::|   |            \:::\   \:::\    \
%        /::::::\    \    /::::::\    \   _____    /::::::\   \:::\    \   /:::/____/   \:::\____\   /::::::\   \:::\    \    /::::::\   \:::\    \    /:::/  |::|___|______    ___\:::\   \:::\    \
%       /:::/\:::\    \  /:::/\:::\    \ /\    \  /:::/\:::\   \:::\    \ |:::|    |     |:::|    | /:::/\:::\   \:::\____\  /:::/\:::\   \:::\    \  /:::/   |::::::::\    \  /\   \:::\   \:::\    \
%      /:::/  \:::\____\/:::/  \:::\    /::\____\/:::/__\:::\   \:::\____\|:::|____|     |:::|    |/:::/  \:::\   \:::|    |/:::/__\:::\   \:::\____\/:::/    |:::::::::\____\/::\   \:::\   \:::\____\
%     /:::/    \::/    /\::/    \:::\  /:::/    /\:::\   \:::\   \::/    / \:::\    \   /:::/    / \::/   |::::\  /:::|____|\:::\   \:::\   \::/    /\::/    / ~~~~~/:::/    /\:::\   \:::\   \::/    /
%    /:::/    / \/____/  \/____/ \:::\/:::/    /  \:::\   \:::\   \/____/   \:::\    \ /:::/    /   \/____|:::::\/:::/    /  \:::\   \:::\   \/____/  \/____/      /:::/    /  \:::\   \:::\   \/____/
%   /:::/    /                    \::::::/    /    \:::\   \:::\    \        \:::\    /:::/    /          |:::::::::/    /    \:::\   \:::\    \                  /:::/    /    \:::\   \:::\    \
%  /:::/    /                      \::::/    /      \:::\   \:::\____\        \:::\__/:::/    /           |::|\::::/    /      \:::\   \:::\____\                /:::/    /      \:::\   \:::\____\
%  \::/    /                       /:::/    /        \:::\   \::/    /         \::::::::/    /            |::| \::/____/        \:::\   \::/    /               /:::/    /        \:::\  /:::/    /
%   \/____/                       /:::/    /          \:::\   \/____/           \::::::/    /             |::|  ~|               \:::\   \/____/               /:::/    /          \:::\/:::/    /
%                                /:::/    /            \:::\    \                \::::/    /              |::|   |                \:::\    \                  /:::/    /            \::::::/    /
%                               /:::/    /              \:::\____\                \::/____/               \::|   |                 \:::\____\                /:::/    /              \::::/    /
%                               \::/    /                \::/    /                 ~~                      \:|   |                  \::/    /                \::/    /                \::/    /
%                                \/____/                  \/____/                                           \|___|                   \/____/                  \/____/                  \/____/
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%for theorems and such, hanging title
\mdfdefinestyle{mdthmbox}{%
      roundcorner=4pt,
      linewidth=1pt,
      skipabove=15pt,
      skipbelow=5pt,
      innertopmargin=6pt,
      nobreak=true,
      innerbottommargin=7pt,
}

\mdfdefinestyle{mdquesbox}{%
      roundcorner=4pt,
      linewidth=1pt,
      skipabove=10pt,
      skipbelow=7pt,
      innertopmargin=9pt,
      nobreak=true,
      innerbottommargin=9pt,
}

  \newlength{\spaceblength}
  \settowidth{\spaceblength}{\bfseries\ }
  \declaretheoremstyle[
      headfont=\bfseries\sffamily,
      notefont=\scshape,
      notebraces={}{\\[\parskip]}, % Braces for additional text
      bodyfont=\normalfont,
      mdframed={style=mdthmbox},
      headpunct={},
      headformat={%
          \checkoddpage\ifoddpage\rlap{\hskip\textwidth\hspace*{2ex}\rmfamily\color{black}\ \ \ \NAME\ \NUMBER}\hskip-\spaceblength{\NOTE}%
          \else\rlap{\hskip\textwidth\hspace*{2ex}\rmfamily\color{black}\ \ \ \NAME\ \NUMBER}\hskip-\spaceblength{\NOTE}\fi%
      },
  ]{hangingtheo}

  \declaretheoremstyle[
      headfont=\bfseries,
      notefont=\scshape,
      notebraces={}{\\[\parskip]}, % Braces for additional text
      bodyfont=\normalfont\itshape,
      mdframed={style=mdquesbox},
      headpunct={},
      headformat={%
          \checkoddpage\ifoddpage\rlap{\hskip\textwidth\hspace*{2ex}\rmfamily\color{black}\ \ \ \NAME\ \NUMBER}\hskip-\spaceblength{\NOTE}%
          \else\rlap{\hskip\textwidth\hspace*{2ex}\rmfamily\color{black}\ \ \ \NAME\ \NUMBER}\hskip-\spaceblength{\NOTE}\fi%
      },
  ]{hangingques}


  %for examples and remarks
  \mdfdefinestyle{examplebox}{%
      skipbelow=2pt,
      roundcorner=1pt,
      skipabove=8pt,
      linewidth=1pt,
      innertopmargin=-10.8pt,
      innerleftmargin=9.2pt,
      innerbottommargin=5pt,
      rightline=false,
      leftline=true,
      topline=true,
      bottomline=false,
      linecolor=slategreen,
      backgroundcolor=coolbeige,
      nobreak=false
  }

  \definecolor{goodpurple}{HTML}{420024}
  \definecolor{coolbeige}{HTML}{F5F6F4}

  \declaretheoremstyle[
    headfont=\bfseries\sffamily\color{coolbeige}\normalsize,
    headformat={%
    \tcbox{\hspace{-2.3mm}\textcolor{coolbeige}{\ \ \ \scshape \NAME\ \NUMBER}}
    },          % Title font and color
    notefont=\normalfont,                    % Font for the optional note
    headpunct={~\\ ~\\ },                            % No punctuation after the title
    headindent=-10.1pt,                          % No indentation for the title
    postheadspace=10pt,                       % No space after the title
    spaceabove=10pt,                         % Space above the theorem box
    spacebelow=10pt,                         % Space below the theorem box
    mdframed={style=examplebox},
  ]{thmexample}

  \mdfdefinestyle{rembox}{%
  skipbelow=20em,
  skipabove=10pt,
  linewidth=1pt,
  innertopmargin=5pt,
  innerleftmargin=12pt,
  innerbottommargin=10pt,
  rightline=false,
  leftline=false,
  topline=true,
  bottomline=true,
  linecolor=black,
  backgroundcolor=coolbeige,
}

  \declaretheoremstyle[
  headfont=\bfseries\sffamily,
  mdframed={style=rembox},
  bodyfont=\small,
  ]{thmremark}

  \declaretheorem[style=hangingtheo,name=Definition,numberwithin=chapter]{definition}


  \declaretheorem[style=thmexample,name=Example,numberwithin=chapter]{example}
  \declaretheorem[style=hangingtheo,name=Theorem,numberwithin=chapter]{theorem}
  \declaretheorem[style=thmremark,name=Remark,numberwithin=section]{remark}
  \declaretheorem[style=hangingques,name=Question,numbered=no]{question}

  \declaretheorem[style=basehead,name=Theorem,numbered=no]{theorem*}
  \declaretheorem[style=hangingtheo,name=Lemma,numbered=no]{lemma*}
  \declaretheorem[style=hangingtheo,name=Lemma,sibling=theorem]{lemma}

  \declaretheorem[style=basehead,name=Proposition,numbered=no]{proposition*}
  \declaretheorem[style=thmexample,name=Corollary,numbered=no]{corollary*}
  \declaretheorem[style=basehead,name=Proposition,sibling=theorem]{proposition}
  \declaretheorem[style=thmexample,name=Corollary,sibling=theorem]{corollary}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   __________   ___  _______ .______        ______  __       _______. _______     _______.%
%  |   ____\  \ /  / |   ____||   _  \      /      ||  |     /       ||   ____|   /       |%
%  |  |__   \  V  /  |  |__   |  |_)  |    |  ,----'|  |    |   (----`|  |__     |   (----`%
%  |   __|   >   <   |   __|  |      /     |  |     |  |     \   \    |   __|     \   \    %
%  |  |____ /  .  \  |  |____ |  |\  \----.|  `----.|  | .----)   |   |  |____.----)   |   %
%  |_______/__/ \__\ |_______|| _| `._____| \______||__| |_______/    |_______|_______/    %
%                                                                                          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \usepackage{xsim, needspace}

  \makeatletter
  \DeclareExerciseEnvironmentTemplate{custom}{%
    \par\vspace{3.25ex plus 1ex minus .2ex}
    \Needspace*{3\baselineskip}%
    \noindent\normalsize
    \textcolor{black}{%
      \textbf{\XSIMmixedcase{\GetExerciseName}\nobreakspace\GetExerciseProperty{counter}}%
    }%
    \IfInsideSolutionF{%
      \GetExercisePropertyT{subtitle}{ {\normalfont\itshape\PropertyValue}}%
    }%
    \normalsize
    \GetExercisePropertyT{points}{%
      \hfill {%
          [{\color{teal}\printgoal{\PropertyValue}}]%
          \GetExercisePropertyT{bonus-points}{~[+\printgoal{\PropertyValue}]}%
      }%
    }%
    \;
    \@afterindentfalse\@afterheading
  }
  {}
  \makeatother

  \xsimsetup{
    exercise/the-counter = \thesection.\arabic{exercise}. ,
    exercise/template = custom ,
    solution/template = custom ,
    exercise/name = 
}

  \newenvironment{exc}{%
      ~\\ \rule[0cm]{\textwidth-4cm}{0.01cm}\rule[-0.11cm]{4cm}{0.12cm} \vskip2pt {\hspace*{\textwidth-3.8cm}\Large\textbf{Exercises}}}%
      {\bigskip \hrule \medskip}
    


\usepackage{ifoddpage}
%sidenote. Better to use than marginnote, as it fixes which side is to be used.
\newcommand{\sidenote}[1]{
  \checkoddpage
  \ifoddpage
    \marginnote{#1}
  \else
    \reversemarginpar
    \marginnote{#1}
    \normalmarginpar
  \fi
}
